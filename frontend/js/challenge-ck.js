function Challenge(e,t,n){this.challenger=e;this.opponentID=t;this.status=n}Challenge.prototype.setStatus=function(e){this.status=e;e=="ACCEPTED"&&window.open("game.php?gameID=","_blank")};Challenge.prototype.getMessage=function(){var e=this.opponentID;switch(this.status){case"PENDING":var t="";if(this.challenger){t+="Waiting for "+e+" to respond to your challenge...";t+='<a href="javascript:window.chats['+this.opponentID+"].challenge.selectNewStatus('CANCELLED');\">Cancel</a>"}else t+=e+' has challenged you to a game! <a href="javascript:window.chats['+this.opponentID+"].challenge.selectNewStatus('ACCEPTED');\">Accept</a> <a href=\"javascript:window.chats["+this.opponentID+"].challenge.selectNewStatus('DENIED');\">Decline</a>";return t;case"VIEWED":return this.challenger?e+" has seen your challenge. Waiting on their response...":"The challenge with "+e+" has been marked as viewed.";case"ACCEPTED":return this.challenger?e+" has accepted your challenge. The game window will open momentarily...":"You have accepted "+e+"'s challenge. The game window will open momentarily...";case"DENIED":return this.challenger?e+" has declined your challenge. Try challenging another online player!":"You have declined the challenge with "+e;case"CANCELLED":return this.challenger?"You have cancelled the challenge to "+e+".":e+" has cancelled the challenge.";default:alert(this.status+" is not a valid status")}};Challenge.prototype.displayOnlinePlayers=function(){ajaxCall("get",{application:"challenge",method:"getOnlinePlayers",data:{room:0}},function(e){e=e.challenge;var t=$("#onlinePlayers ul");t.html("");for(var n=0;n<e.length;n++)if(window.player.id!=e[n].id){var r=$('<li id="onlinePlayer'+e[n].id+'">'),i=$("<a>");i.attr("href","javascript://");i.click(function(){var e=$(this).parent().attr("id").substring("onlinePlayer".length);e=parseInt(e);if(window.chats[e]!==undefined)window.chats[e].challenge===undefined?window.chats[e].challenge=new Challenge(window.player.id,e,"PENDING"):window.chats[e].challenge.selectNewStatus("PENDING");else{var t=Chat.prototype.createChatWindow($(this).text());window.chats[e]=new Chat(t,e);window.chats[e].challenge=new Challenge(window.player.id,e,"PENDING");window.chats[e].challenge.selectNewStatus("PENDING")}});i.text(e[n].username);r.append(i);t.append(r)}})};Challenge.prototype.selectNewStatus=function(e){var t=this;ajaxCall("post",{application:"challenge",method:"updateChallengeStatus",data:{challengerID:t.challenger?window.player.id:t.opponentID,challengeeID:t.challenger?t.opponentID:window.player.id,newStatus:e}},function(n){if(n.challenge.success===undefined||n.challenge.success!==!0)alert(n.challenge.error);else{t.setStatus(e);window.chats[t.opponentID].updateChallengeMessage()}})};$(document).ready(function(){setInterval(function(){Challenge.prototype.displayOnlinePlayers()},3e3);setInterval(function(){ajaxCall("get",{application:"challenge",method:"getChallenges",data:{playerID:window.player.id}},function(e){e=e.challenge;for(var t=0;t<e.length;++t){var n,r;if(e[t].challengerID==window.player.id){n=!0;r=e[t].challengeeID}else if(e[t].challengeeID==window.player.id){n=!1;r=e[t].challengerID}else{console.log("user - "+window.player.id);console.log("The challenge ajax call returned a challenge that doesn't belong to this user.");console.log(e[t])}if(window.chats[r]!==undefined){window.chats[r].challenge===undefined?window.chats[r].challenge=new Challenge(e[t].challengerID==window.player.id,r,e[t].status):window.chats[r].challenge.setStatus(e[t].status);window.chats[r].updateChallengeMessage()}else{var i=Chat.prototype.createChatWindow(r);window.chats[r]=new Chat(i,r);window.chats[r].challenge=new Challenge(e[t].challengerID==window.player.id,r,"PENDING")}}})},2e3)});